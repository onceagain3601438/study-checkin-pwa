<!--å­¦ä¹ æ‰“å¡é¡µé¢-->
<view class="checkin-container">
  <!-- é¡µé¢æ ‡é¢˜å’Œæ—¥æœŸ -->
  <view class="header">
    <view class="date-section">
      <text class="current-date">{{currentDateText}}</text>
      <view class="date-navigation">
        <view class="nav-btn" bindtap="onPrevDay">
          <text class="nav-icon">â€¹</text>
        </view>
        <view class="nav-btn" bindtap="onNextDay">
          <text class="nav-icon">â€º</text>
        </view>
      </view>
    </view>
    <view class="header-content">
      <text class="page-title">å­¦ä¹ è®¡åˆ’</text>
      <view class="total-points">
        <text class="points-icon">ğŸ†</text>
        <text class="points-value">{{totalPoints}}</text>
        <text class="points-unit">æ€»ç§¯åˆ†</text>
      </view>
    </view>
    
    <!-- åŠ±å¿—è¯è¯­åŒºåŸŸ -->
    <view class="motivational-section">
      <text class="motivational-text">ğŸ’ª åšæŒæ¯ä¸€å¤©ï¼Œæˆå°±æ›´å¥½çš„è‡ªå·±ï¼</text>
      <text class="motivational-sub">æ¯ä¸€ä»½åŠªåŠ›éƒ½ä¸ä¼šç™½è´¹ï¼Œæ¯ä¸€æ¬¡åšæŒéƒ½æ˜¯æˆé•¿ âœ¨</text>
    </view>
  </view>

  <!-- å­¦ä¹ è®¡åˆ’åˆ—è¡¨ -->
  <view class="study-plans">
    <view 
      class="plan-item"
      wx:for="{{studyPlans}}"
      wx:key="id">
      
      <!-- è®¡åˆ’æ ‡é¢˜ -->
      <view class="plan-header">
        <view class="plan-title">
          <text class="plan-name">{{item.name}}</text>
          <view class="plan-actions">
            <view class="action-icon" bindtap="onSavePlanAsTemplate" data-plan="{{item}}">
              <text>ğŸ“</text>
            </view>
            <view class="action-icon" bindtap="onEditPlan" data-plan="{{item}}">
              <text>âœï¸</text>
            </view>
            <view class="action-icon" bindtap="onDeletePlan" data-plan="{{item}}">
              <text>ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
        <text class="plan-description" wx:if="{{item.description}}">{{item.description}}</text>
      </view>

      <!-- å­¦ä¹ ä»»åŠ¡è¡¨æ ¼ -->
      <view class="tasks-table">
        <!-- è¡¨æ ¼å¤´éƒ¨ -->
        <view class="table-header">
          <view class="col time-slot">æ—¶é—´æ®µ</view>
          <view class="col task-name">ä»»åŠ¡</view>
          <view class="col study">å­¦ä¹ </view>
          <view class="col master">æŒæ¡</view>
          <view class="col points">ç§¯åˆ†</view>
        </view>

        <!-- ä»»åŠ¡è¡Œ -->
        <view 
          class="table-row"
          wx:for="{{item.tasks}}"
          wx:for-item="task"
          wx:key="id">
          
          <!-- æ—¶é—´æ®µ -->
          <view class="col time-slot">
            <view 
              class="time-slot-btn {{task.timeSlot ? 'has-time' : 'no-time'}}"
              bindtap="onSetTimeSlot"
              data-plan-id="{{item.id}}"
              data-task-id="{{task.id}}">
              <text wx:if="{{task.timeSlot}}">{{task.timeSlot}}</text>
              <text wx:else>è®¾ç½®æ—¶é—´</text>
            </view>
          </view>
          
          <!-- ä»»åŠ¡åç§° -->
          <view class="col task-name">
            <view class="task-content">
              <text 
                class="task-text"
                bindtap="onEditTask"
                data-plan-id="{{item.id}}"
                data-task-id="{{task.id}}">
                {{task.name}}
              </text>
              <view class="task-delete-btn" bindtap="onDeleteTask" data-plan-id="{{item.id}}" data-task-id="{{task.id}}">
                <text class="delete-icon">ğŸ—‘ï¸</text>
              </view>
            </view>
          </view>
          
          <!-- å­¦ä¹  -->
          <view class="col study">
            <view 
              class="checkbox {{task.studyCompleted ? 'checked' : ''}}"
              bindtap="onToggleStudy"
              data-plan-id="{{item.id}}"
              data-task-id="{{task.id}}">
              <text class="check-mark" wx:if="{{task.studyCompleted}}">âœ“</text>
            </view>
          </view>
          
          <!-- æŒæ¡ -->
          <view class="col master">
            <view 
              class="checkbox {{task.masteredCompleted ? 'checked' : ''}}"
              bindtap="onToggleMaster"
              data-plan-id="{{item.id}}"
              data-task-id="{{task.id}}">
              <text class="check-mark" wx:if="{{task.masteredCompleted}}">âœ“</text>
            </view>
          </view>
          
          <!-- ç§¯åˆ† -->
          <view class="col points">
            <view 
              class="points-btn {{task.points > 0 ? 'has-points' : 'no-points'}}"
              bindtap="onSetPoints"
              data-plan-id="{{item.id}}"
              data-task-id="{{task.id}}">
              <view wx:if="{{task.points > 0}}">
                <view class="points-total">{{task.points}}åˆ†</view>
                <view class="points-detail">({{task.earnedPoints}}/{{task.points}})</view>
              </view>
              <text wx:else>è®¾ç½®ç§¯åˆ†</text>
            </view>
          </view>
        </view>

        <!-- æ·»åŠ ä»»åŠ¡æŒ‰é’® -->
        <view class="add-task-row">
          <button 
            class="add-task-btn"
            bindtap="onAddTask"
            data-plan-id="{{item.id}}">
            + æ·»åŠ ä»»åŠ¡
          </button>
        </view>
      </view>

      <!-- è®¡åˆ’å®Œæˆåº¦ -->
      <view class="plan-progress">
        <view class="progress-info">
          <text class="progress-text">å®Œæˆåº¦: {{item.completionRate}}%</text>
          <text class="task-count">{{item.completedTasks}}/{{item.totalTasks}} é¡¹ä»»åŠ¡</text>
        </view>
        <view class="points-info">
          <text class="points-text">ç§¯åˆ†: {{item.earnedPoints}}/{{item.totalPoints}} åˆ†</text>
        </view>
        <view class="progress-bar">
          <view 
            class="progress-fill"
            style="width: {{item.completionRate}}%">
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{studyPlans.length === 0}}">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-title">è¿˜æ²¡æœ‰å­¦ä¹ è®¡åˆ’</text>
    <text class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå­¦ä¹ è®¡åˆ’</text>
  </view>

  <!-- å¿«é€Ÿæ“ä½œåŒºåŸŸ -->
  <view class="quick-actions" wx:if="{{studyPlans.length === 0}}">
    <button class="quick-btn copy-btn" bindtap="onCopyYesterday">
      <text class="quick-icon">ğŸ“‹</text>
      <text class="quick-text">å¤åˆ¶æ˜¨å¤©</text>
    </button>
    <button class="quick-btn template-btn" bindtap="onLoadTemplate">
      <text class="quick-icon">ğŸ“</text>
      <text class="quick-text">åŠ è½½æ¨¡æ¿</text>
    </button>
    <button class="quick-btn default-btn" bindtap="onLoadDefault">
      <text class="quick-icon">â­</text>
      <text class="quick-text">é»˜è®¤è®¡åˆ’</text>
    </button>
  </view>

  <!-- æ·»åŠ è®¡åˆ’æŒ‰é’® -->
  <view class="add-plan-section">
    <button class="add-plan-btn" bindtap="onAddPlan">
      <text class="add-icon">+</text>
      <text class="add-text">æ·»åŠ å­¦ä¹ è®¡åˆ’</text>
    </button>
  </view>

  <!-- ä»Šæ—¥æ€»ç»“ -->
  <view class="daily-summary" wx:if="{{studyPlans.length > 0}}">
    <view class="summary-header">
      <text class="summary-title">ä»Šæ—¥æ€»ç»“</text>
    </view>
    <view class="summary-stats">
      <view class="stat-item">
        <text class="stat-number">{{dailyStats.totalPlans}}</text>
        <text class="stat-label">å­¦ä¹ è®¡åˆ’</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{dailyStats.completedTasks}}</text>
        <text class="stat-label">å®Œæˆä»»åŠ¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{dailyStats.completionRate}}%</text>
        <text class="stat-label">å®Œæˆç‡</text>
      </view>
      <view class="stat-item">
        <text class="stat-number earned-points">{{dailyStats.earnedPoints}}</text>
        <text class="stat-label">è·å¾—ç§¯åˆ†</text>
      </view>
    </view>
  </view>
</view> 